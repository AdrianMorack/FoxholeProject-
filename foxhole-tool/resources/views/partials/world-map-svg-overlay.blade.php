{{-- SVG Overlay for Interactive World Map Hexes --}}
<svg class="absolute inset-0 w-full h-full" viewBox="0 0 2560 1554" preserveAspectRatio="xMidYMid meet" style="z-index: 10;">
    <defs>
        @foreach($maps ?? [] as $map)
            @php
                $colonialPct = $map['colonial_percent'] ?? 0;
                $wardenPct = $map['warden_percent'] ?? 0;
                $mapId = $map['name'];
            @endphp
            <linearGradient id="grad-{{ $mapId }}" x1="0%" y1="100%" x2="0%" y2="0%">
                {{-- Bottom to top: Colonial percentage from bottom, Warden from top --}}
                @if($colonialPct > 0 && $wardenPct > 0)
                    <stop offset="0%" style="stop-color:rgba(34, 197, 94, 0.4);stop-opacity:1" />
                    <stop offset="{{ $colonialPct }}%" style="stop-color:rgba(34, 197, 94, 0.4);stop-opacity:1" />
                    <stop offset="{{ $colonialPct }}%" style="stop-color:rgba(59, 130, 246, 0.4);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:rgba(59, 130, 246, 0.4);stop-opacity:1" />
                @elseif($colonialPct > 0)
                    <stop offset="0%" style="stop-color:rgba(34, 197, 94, 0.4);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:rgba(34, 197, 94, 0.4);stop-opacity:1" />
                @elseif($wardenPct > 0)
                    <stop offset="0%" style="stop-color:rgba(59, 130, 246, 0.4);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:rgba(59, 130, 246, 0.4);stop-opacity:1" />
                @else
                    <stop offset="0%" style="stop-color:rgba(193, 193, 193, 0.25);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:rgba(193, 193, 193, 0.25);stop-opacity:1" />
                @endif
            </linearGradient>
        @endforeach
    </defs>
    
    @php
        // Create a lookup map for team data
        $mapTeams = [];
        foreach ($maps ?? [] as $map) {
            $mapTeams[$map['name']] = [
                'warden_percent' => $map['warden_percent'] ?? 0,
                'colonial_percent' => $map['colonial_percent'] ?? 0,
                'warden_count' => $map['warden_count'] ?? 0,
                'colonial_count' => $map['colonial_count'] ?? 0,
            ];
        }
        
        $hexRegions = [
            ['id' => 'AcrithiaHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7002139,0,0,1.7424381,-612.16661,830.76598)'],
            ['id' => 'AllodsBightHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7322108,-457.8699,500.8963)'],
            ['id' => 'AshFieldsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1223.9686,718.62047)'],
            ['id' => 'BasinSionnachHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-842.15971,-391.10503)'],
            ['id' => 'CallahansPassageHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-842.57372,52.183872)'],
            ['id' => 'CallumsCapeHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1225.4456,-168.48826)'],
            ['id' => 'ClahstraHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-458.18163,274.16815)'],
            ['id' => 'ClansheadValleyHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7238493,0,0,1.734796,-449.55596,-166.58586)'],
            ['id' => 'DeadLandsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-841.29298,275.80956)'],
            ['id' => 'DrownedValeHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-649.86982,384.96769)'],
            ['id' => 'EndlessShoreHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.709071,0,0,1.7680065,-239.74358,379.39074)'],
            ['id' => 'FarranacCoastHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7254111,0,0,1.7286632,-1409.7245,169.24054)'],
            ['id' => 'TheFingersHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,116.59431,384.97588)'],
            ['id' => 'FishermansRowHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1607.6837,273.87262)'],
            ['id' => 'GodcroftsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-74.701788,49.639816)'],
            ['id' => 'GreatMarchHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-840.09967,718.70459)'],
            ['id' => 'GutterHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7577251,-1609.9913,49.043384)'],
            ['id' => 'HeartlandsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7434056,0,0,1.7475518,-1047.365,607.54646)'],
            ['id' => 'HomeRegionC', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1417.8699,912.96764)'],
            ['id' => 'HomeRegionW', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-264.78171,-364.61632)'],
            ['id' => 'HowlCountyHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-649.52202,-280.5699)'],
            ['id' => 'KalokaiHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-840.9287,941.94834)'],
            ['id' => 'KingsCageHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7377372,0,0,1.7287207,-1233.4418,279.66211)'],
            ['id' => 'KuuraStrandHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7356191,0,0,1.733539,-1615.6764,-166.04363)'],
            ['id' => 'LinnMercyHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1032.3657,163.51175)'],
            ['id' => 'LochMorHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7344755,0,0,1.7362531,-1037.0418,387.8942)'],
            ['id' => 'LykosIsleHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,116.37813,162.96769)'],
            ['id' => 'MarbanHollow', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7348962,0,0,1.7305441,-654.84129,168.04683)'],
            ['id' => 'MooringCountyHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.711644,0,0,1.7287207,-1009.7877,-52.074794)'],
            ['id' => 'MorgensCrossingHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-266.66183,-60.360184)'],
            ['id' => 'NevishLineHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1417.4538,-57.864278)'],
            ['id' => 'OarbreakerHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1799.4665,387.87562)'],
            ['id' => 'OlavisWakeHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1993.3011,52.357927)'],
            ['id' => 'OnyxHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7175162,0,0,1.7396434,-56.797935,720.37281)'],
            ['id' => 'OriginHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1415.3447,609.54055)'],
            ['id' => 'PalantineBermHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1800.1822,164.55774)'],
            ['id' => 'PariPeakHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7289763,-1802.9913,-53.014526)'],
            ['id' => 'PipersEnclaveHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,309.37744,495.53645)'],
            ['id' => 'ReachingTrailHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7246943,0,0,1.7437877,-833.78954,-168.13751)'],
            ['id' => 'ReaversPassHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7267853,0,0,1.7270971,-260.52374,614.11289)'],
            ['id' => 'RedRiverHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1032.0086,828.62047)'],
            ['id' => 'SableportHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7181673,0,0,1.7324869,-1209.0148,500.54656)'],
            ['id' => 'ShackledChasmHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7179282,0,0,1.7270971,-633.11007,613.0984)'],
            ['id' => 'SpeakingWoodsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1034.0778,-279.99235)'],
            ['id' => 'StemaLandingHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-1606.8288,498.41075)'],
            ['id' => 'StlicanShelfHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-265.07781,162.59167)'],
            ['id' => 'StonecradleHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7289763,-1225.3657,57.876187)'],
            ['id' => 'TempestIslandHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-73.989702,273.26379)'],
            ['id' => 'TerminusHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7489282,0,0,1.7475518,-479.78401,718.49602)'],
            ['id' => 'TyrantFoothillsHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,117.49724,606.52826)'],
            ['id' => 'UmbralWildwoodHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7234824,-840.83019,504.26713)'],
            ['id' => 'ViperPitHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-650.62187,-58.896049)'],
            ['id' => 'WeatheredExpanseHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7348961,0,0,1.734796,-462.439,55.989958)'],
            ['id' => 'WestgateHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.711644,0,0,1.7478075,-1393.0566,385.39944)'],
            ['id' => 'WrestaHex', 'd' => 'm 1299.4177,287.716 -36.925,63.95594 h -73.8499 l -36.925,-63.95594 36.925,-63.95593 73.8499,0 z', 'transform' => 'matrix(1.7312139,0,0,1.7475518,-75.285888,495.96769)'],
        ];
    @endphp

    @foreach($hexRegions as $hex)
        @php
            // Map API names to display names
            $displayNames = [
                'TheFingersHex' => 'The Fingers',
                'MooringCountyHex' => 'Mooring County',
                'OarbreakerHex' => 'Oarbreaker Isles',
                'MarbanHollow' => 'Marban Hollow',
                'DeadLandsHex' => 'Dead Lands',
                'HomeRegionC' => 'Colonial Home Region',
                'HomeRegionW' => 'Warden Home Region',
            ];
            
            $displayName = $displayNames[$hex['id']] ?? str_replace('Hex', '', $hex['id']);
            
            // Get team control for this hex
            $teamData = $mapTeams[$hex['id']] ?? null;
            
            $wardenPct = $teamData['warden_percent'] ?? 0;
            $colonialPct = $teamData['colonial_percent'] ?? 0;
            $wardenCount = $teamData['warden_count'] ?? 0;
            $colonialCount = $teamData['colonial_count'] ?? 0;
            
            // Determine stroke color based on majority
            if ($wardenPct > $colonialPct) {
                $strokeColor = 'rgba(59, 130, 246, 0.9)';  // Blue for Wardens
            } elseif ($colonialPct > $wardenPct) {
                $strokeColor = 'rgba(34, 197, 94, 0.9)';   // Green for Colonials
            } else {
                $strokeColor = 'rgba(74, 124, 89, 0.8)';  // Neutral
            }
            
            // Use gradient fill if we have data, otherwise default
            $fillStyle = $teamData ? "url(#grad-{$hex['id']})" : 'rgba(193, 193, 193, 0.25)';
            
            // Create title with ownership info
            $title = $displayName;
            if ($wardenCount > 0 || $colonialCount > 0) {
                $title .= "\nWardens: {$wardenCount} ({$wardenPct}%)\nColonials: {$colonialCount} ({$colonialPct}%)";
            }
        @endphp
        <a href="{{ route('map-viewer', ['shard' => session('foxhole_shard', 'baker'), 'mapName' => $hex['id']]) }}"
           class="hex-link">
            <path
               class="hex-region"
               style="fill: {{ $fillStyle }}; stroke: {{ $strokeColor }}; stroke-width: 3;"
               d="{{ $hex['d'] }}"
               transform="{{ $hex['transform'] }}"
            >
                <title>{{ $title }}</title>
            </path>
        </a>
    @endforeach
</svg>
